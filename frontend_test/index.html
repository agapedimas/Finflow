<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finflow Test Bench</title>
    <style>
        body { font-family: sans-serif; max-width: 800px; margin: 20px auto; padding: 20px; }
        .box { border: 1px solid #ccc; padding: 20px; margin-bottom: 20px; border-radius: 8px; }
        .hidden { display: none; }
        .active-section { display: block; }
        button { padding: 10px; cursor: pointer; margin: 5px 0; }
        input, select { padding: 8px; margin: 5px 0; width: 100%; box-sizing: border-box; }
        label { font-weight: bold; display: block; margin-top: 10px; }
        .status-bar { background: #e0e0e0; padding: 10px; margin-bottom: 20px; border-radius: 5px; }
        code { background: #f4f4f4; padding: 2px 5px; }
        h2 { border-bottom: 2px solid #333; padding-bottom: 5px; }
    </style>

    <script src="https://cdn.jsdelivr.net/npm/@web3auth/modal@9.4.0/dist/modal.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@web3auth/ethereum-provider@9.4.0/dist/ethereumProvider.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js" type="application/javascript"></script>
</head>
<body>

    <h1>üõ†Ô∏è Finflow Integration Test</h1>

    <div class="status-bar">
        <div><strong>Status:</strong> <span id="connectionStatus">Belum Konek Web3Auth</span></div>
        <div><strong>Email:</strong> <code id="myEmail">-</code></div>
        <div><strong>Wallet:</strong> <code id="myWallet">-</code></div>
        <button onclick="loginWeb3()" id="btnLogin">üîë LOGIN / CONNECT WALLET</button>
        <button onclick="logoutWeb3()" id="btnLogout" class="hidden">LOGOUT</button>
    </div>

    <hr>

    <div id="scenario-menu" class="hidden">
        <h3>Pilih Skenario Testing:</h3>
        <button onclick="showSection('sec-funder')">1. Daftar Funder</button>
        <button onclick="showSection('sec-invite')">2. Buat Invite (Funder Only)</button>
        <button onclick="showSection('sec-student')">3. Aktivasi Student (Punya Token)</button>
        <button onclick="showSection('sec-parent')">4. Aktivasi Parent (Punya Token)</button>
        <button onclick="showSection('sec-login')">5. Login Biasa (Cek Akun)</button>
    </div>

    <hr>

    <div id="sec-funder" class="box hidden">
        <h2>1. Register Funder</h2>
        <form onsubmit="apiRegisterFunder(event)">
            <label>Nama Lengkap:</label> <input type="text" id="f_name" value="Bapak Yayasan">
            <label>Nama Organisasi:</label> <input type="text" id="f_org" value="Finflow Foundation">
            <label>Bank:</label> <input type="text" id="f_bank" value="BCA">
            <label>No Rek:</label> <input type="text" id="f_rek" value="1234567890">
            <button type="submit">Daftar Funder</button>
        </form>
    </div>

    <div id="sec-invite" class="box hidden">
        <h2>2. Generate Invite Code</h2>
        <p><em>Hanya bisa dilakukan jika wallet yang login sudah terdaftar sebagai user.</em></p>
        <form onsubmit="apiCreateInvite(event)">
            <label>Email Tujuan:</label> <input type="email" id="i_email" placeholder="student@mail.com">
            <label>Role Target:</label>
            <select id="i_role">
                <option value="student">Student</option>
                <option value="parent">Parent</option>
            </select>
            <button type="submit">Buat Token Undangan</button>
        </form>
        <div style="margin-top:10px; background:#fffae6; padding:10px;">
            <strong>Hasil Token (Copy Ini):</strong> <br>
            <code id="inviteResult">-</code>
        </div>
    </div>

    <div id="sec-student" class="box hidden">
        <h2>3. Aktivasi Student</h2>
        <p>Pastikan Anda sudah LOGOUT dari akun Funder dan LOGIN dengan akun Google baru (sebagai Student).</p>
        <form onsubmit="apiRegisterStudent(event)">
            <label>Token Undangan:</label> <input type="text" id="s_token" placeholder="Paste Token Disini">
            <label>Nama Lengkap:</label> <input type="text" id="s_name" value="Budi Santoso">
            <label>Bank:</label> <input type="text" id="s_bank" value="Mandiri">
            <label>No Rek:</label> <input type="text" id="s_rek" value="999888777">
            <label>Password (Backup):</label> <input type="text" id="s_pass" value="rahasia123">
            <button type="submit">Aktifkan Akun Student</button>
        </form>
    </div>

    <div id="sec-parent" class="box hidden">
        <h2>4. Aktivasi Parent</h2>
        <form onsubmit="apiRegisterParent(event)">
            <label>Token Undangan:</label> <input type="text" id="p_token" placeholder="Paste Token Disini">
            <label>Nama Lengkap:</label> <input type="text" id="p_name" value="Pak Santoso">
            <label>Password (Backup):</label> <input type="text" id="p_pass" value="rahasia123">
            <button type="submit">Aktifkan Akun Parent</button>
        </form>
    </div>

    <div id="sec-login" class="box hidden">
        <h2>5. Cek Login</h2>
        <p>Cek apakah wallet ini sudah terdaftar di database.</p>
        <button onclick="apiLogin()">Cek Status Akun Saya</button>
    </div>

    <script src="logic.js"></script>
</body>
</html>